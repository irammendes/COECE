<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário SCI 234</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="text"],
        input[type="date"],
        input[type="time"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .date-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            background-color: #0066cc;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        button:hover {
            background-color: #0055aa;
        }
        #pdfPreview {
            position: absolute;
            left: -9999px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FORMULÁRIO SCI 234</h1>
        
        <form id="sciForm">
            <div class="form-group">
                <label for="eventName">1. Nome do Evento</label>
                <input type="text" id="eventName" required>
            </div>
            
            <div class="form-group">
                <label for="startDate">2. Período Operacional</label>
                <div class="date-range">
                    <input type="date" id="startDate" required>
                    <span>até</span>
                    <input type="date" id="endDate" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="objectives">3. Objetivos do Período Operacional / Resultados desejados</label>
                <textarea id="objectives" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="strategies">4. Estratégias Operacionais (Como fazer?)</label>
                <textarea id="strategies" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="tactics">5. Táticas/Técnicas (Quem/O que/Onde/Quando)</label>
                <textarea id="tactics" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="preparedBy">6. Elaborado por: (Chefe Seção de Operações)</label>
                <input type="text" id="preparedBy" required>
            </div>
            
            <div class="form-group">
                <label for="currentDate">7. Data:</label>
                <input type="date" id="currentDate" required>
            </div>
            
            <div class="form-group">
                <label for="currentTime">Hora:</label>
                <input type="time" id="currentTime" required>
            </div>
            
            <button type="button" onclick="gerarPDF()">Gerar PDF para Impressão</button>
        </form>
    </div>

    <div id="pdfPreview">
        <div style="width: 210mm; min-height: 297mm; padding: 15mm; margin: 0 auto; box-sizing: border-box; font-family: Arial, sans-serif; background: white; position: relative;">
            <div style="position: absolute; top: 15mm; left: 15mm;">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxzJ017VFFl09z6LzBxTtNC6axLwHq6YYK-A&s" style="max-width: 50mm; max-height: 20mm;">
            </div>
            
            <div style="text-align: center; margin-bottom: 10mm; padding-top: 10mm;">
                <div style="font-size: 14pt; font-weight: bold; margin-bottom: 5px;">FORMULÁRIO SCI 234</div>
                
            </div>
            
            <div style="position: absolute; top: 15mm; right: 15mm; text-align: right; font-size: 9pt; border: 1px solid #ddd; padding: 5px;">
                <div style="font-weight: bold;">COORDENAÇÃO</div>
                <div>Emergências climáticas e epizotias</div>
            </div>
            
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 10mm; border: 1px solid #000;">
                <tr>
                    <td style="border: 1px solid #000; padding: 8px; width: 50%; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">1. Nome do Evento</div>
                        <div id="pdfEventName" style="min-height: 20mm; word-break: break-word; padding: 5px; border: 1px dashed #ccc;"></div>
                    </td>
                    <td style="border: 1px solid #000; padding: 8px; width: 50%; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">2. Período Operacional</div>
                        <div style="display: flex; gap: 10px; min-height: 20mm;">
                            <div style="flex: 1; padding: 5px;">
                                <div style="font-weight: bold; font-size: 10pt;">De:</div>
                                <div id="pdfStartDate" style="border: 1px dashed #ccc; padding: 5px; min-height: 8mm;"></div>
                            </div>
                            <div style="flex: 1; padding: 5px;">
                                <div style="font-weight: bold; font-size: 10pt;">Até:</div>
                                <div id="pdfEndDate" style="border: 1px dashed #ccc; padding: 5px; min-height: 8mm;"></div>
                            </div>
                        </div>
                    </td>
                </tr>
                
                <tr>
                    <td colspan="2" style="border: 1px solid #000; padding: 8px; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">3. Objetivos do Período Operacional / Resultados desejados</div>
                        <div id="pdfObjectives" style="min-height: 40mm; word-break: break-word; padding: 10px; border: 1px dashed #ccc; line-height: 1.5;"></div>
                    </td>
                </tr>
                
                <tr>
                    <td style="border: 1px solid #000; padding: 8px; width: 50%; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">4. Estratégias Operacionais (Como fazer?)</div>
                        <div id="pdfStrategies" style="min-height: 50mm; word-break: break-word; padding: 10px; border: 1px dashed #ccc; line-height: 1.5;"></div>
                    </td>
                    <td style="border: 1px solid #000; padding: 8px; width: 50%; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">5. Táticas/Técnicas (Quem/O que/Onde/Quando)</div>
                        <div id="pdfTactics" style="min-height: 50mm; word-break: break-word; padding: 10px; border: 1px dashed #ccc; line-height: 1.5;"></div>
                    </td>
                </tr>
                
                <tr>
                    <td style="border: 1px solid #000; padding: 8px; width: 50%; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">6. Elaborado por: (Chefe Seção de Operações)</div>
                        <div id="pdfPreparedBy" style="min-height: 15mm; word-break: break-word; padding: 5px; border: 1px dashed #ccc;"></div>
                    </td>
                    <td style="border: 1px solid #000; padding: 8px; width: 50%; vertical-align: top;">
                        <div style="font-weight: bold; margin-bottom: 5px;">7. Data/Horário:</div>
                        <div style="display: flex; gap: 10px; min-height: 15mm;">
                            <div style="flex: 1; padding: 5px;">
                                <div style="font-weight: bold; font-size: 10pt;">Data:</div>
                                <div id="pdfCurrentDate" style="border: 1px dashed #ccc; padding: 5px; min-height: 8mm;"></div>
                            </div>
                            <div style="flex: 1; padding: 5px;">
                                <div style="font-weight: bold; font-size: 10pt;">Hora:</div>
                                <div id="pdfCurrentTime" style="border: 1px dashed #ccc; padding: 5px; min-height: 8mm;"></div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
            

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const timeStr = today.getHours().toString().padStart(2, '0') + ':' + 
                            today.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('currentDate').value = dateStr;
            document.getElementById('currentTime').value = timeStr;
            
            const nextWeek = new Date();
            nextWeek.setDate(today.getDate() + 7);
            const nextWeekStr = nextWeek.toISOString().split('T')[0];
            document.getElementById('startDate').value = dateStr;
            document.getElementById('endDate').value = nextWeekStr;
        });

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            return `${hours.padStart(2, '0')}:${minutes.padStart(2, '0')}`;
        }

        function gerarPDF() {
            const requiredFields = [
                'eventName', 'startDate', 'endDate', 'objectives',
                'strategies', 'tactics', 'preparedBy', 'currentDate', 'currentTime'
            ];
            
            let isValid = true;
            requiredFields.forEach(field => {
                if (!document.getElementById(field).value) {
                    alert(`Por favor, preencha o campo: ${field.replace(/([A-Z])/g, ' $1').trim()}`);
                    isValid = false;
                }
            });
            
            if (!isValid) return;
            
            document.getElementById('pdfEventName').textContent = document.getElementById('eventName').value;
            document.getElementById('pdfStartDate').textContent = formatDate(document.getElementById('startDate').value);
            document.getElementById('pdfEndDate').textContent = formatDate(document.getElementById('endDate').value);
            document.getElementById('pdfObjectives').textContent = document.getElementById('objectives').value;
            document.getElementById('pdfStrategies').textContent = document.getElementById('strategies').value;
            document.getElementById('pdfTactics').textContent = document.getElementById('tactics').value;
            document.getElementById('pdfPreparedBy').textContent = document.getElementById('preparedBy').value;
            document.getElementById('pdfCurrentDate').textContent = formatDate(document.getElementById('currentDate').value);
            document.getElementById('pdfCurrentTime').textContent = formatTime(document.getElementById('currentTime').value);
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4',
                putOnlyUsedFonts: true,
                compress: true
            });
            
            const pdfPreview = document.getElementById('pdfPreview');
            const options = {
                scale: 2,
                useCORS: true,
                logging: false,
                scrollX: 0,
                scrollY: 0,
                allowTaint: true,
                letterRendering: true,
                useOverflow: false,
                backgroundColor: '#FFFFFF'
            };
            
            html2canvas(pdfPreview, options).then(canvas => {
                const imgData = canvas.toDataURL('image/png', 1.0);
                const imgWidth = 210;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight, undefined, 'FAST');
                
                pdf.setGState(new pdf.GState({opacity: 0.1}));
                pdf.setFontSize(60);
                pdf.setTextColor(200);
                pdf.text('COECE', 105, 150, {angle: 45, align: 'center'});
                pdf.setGState(new pdf.GState({opacity: 1}));
                
                const eventName = document.getElementById('eventName').value.replace(/[^a-zA-Z0-9]/g, '_');
                const dateStr = formatDate(document.getElementById('currentDate').value).replace(/\//g, '-');
                const fileName = `SCI_234_${eventName}_${dateStr}.pdf`;
                pdf.save(fileName);
            });
        }
    </script>
</body>
</html>
